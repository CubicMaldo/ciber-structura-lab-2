[gd_scene load_steps=30 format=3 uid="uid://bj4pvaxj8x3j4"]

[ext_resource type="Script" uid="uid://bqrslvoaus44x" path="res://scripts/missions/mission_final/MissionFinal.gd" id="1"]
[ext_resource type="Script" uid="uid://f3rodujd6g18" path="res://scripts/utils/graphs/visuals/GraphDisplay.gd" id="2"]
[ext_resource type="Shader" uid="uid://c4311yijxvty0" path="res://shaders/scroll.gdshader" id="2_xkgub"]
[ext_resource type="PackedScene" uid="uid://b7qv5xk8p3nt1" path="res://scenes/views/NodeView.tscn" id="3"]
[ext_resource type="Texture2D" uid="uid://cpl2u5010id2e" path="res://sprites/pattern_47.png" id="3_mfvuu"]
[ext_resource type="PackedScene" uid="uid://c5h8lam2n4p6q" path="res://scenes/views/EdgeView.tscn" id="4"]
[ext_resource type="Script" uid="uid://fgm4ahof83xw" path="res://scripts/utils/graphs/editor/GraphBuilder.gd" id="5"]
[ext_resource type="Script" uid="uid://5x1d3j1l85ra" path="res://scripts/utils/graphs/editor/GraphNodeData.gd" id="6"]
[ext_resource type="Script" uid="uid://dkmqha3s6mcs" path="res://scripts/missions/mission_1/NetworkNodeMeta.gd" id="7"]
[ext_resource type="Theme" uid="uid://bx4q87ca62215" path="res://scenes/ui/theme.tres" id="10_mfvuu"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_abame"]
shader = ExtResource("2_xkgub")
shader_parameter/rotate_degree = 30.000000447036
shader_parameter/move_degree = 45.000000670554
shader_parameter/speed = 0.2000000095
shader_parameter/scale = 0.2
shader_parameter/gap = Vector2(0, 0)
shader_parameter/node_scale = Vector2(1, 1)
shader_parameter/tint = Color(0.42745098, 0.52156866, 0.64705884, 0.627451)

[sub_resource type="Resource" id="NetworkNodeMeta_core"]
script = ExtResource("7")
hidden_message = "El núcleo revela la ruta hacia el registro maestro."
threat_level = 3
device_type = "Kernel"
display_name = "Núcleo Central"

[sub_resource type="Resource" id="GraphNodeData_core"]
script = ExtResource("6")
node_key = "Núcleo Central"
vertex_meta = SubResource("NetworkNodeMeta_core")

[sub_resource type="Resource" id="NetworkNodeMeta_aegis"]
script = ExtResource("7")
hidden_message = "Anillo Aegis estabiliza el perímetro."
threat_level = 2
device_type = "Shield"
display_name = "Anillo Aegis"

[sub_resource type="Resource" id="GraphNodeData_aegis"]
script = ExtResource("6")
node_key = "Anillo Aegis"
vertex_meta = SubResource("NetworkNodeMeta_aegis")

[sub_resource type="Resource" id="NetworkNodeMeta_canal_a"]
script = ExtResource("7")
hidden_message = "Canal Alfa redirige paquetes confiables."
threat_level = 1
device_type = "Canal"
display_name = "Canal Alfa"

[sub_resource type="Resource" id="GraphNodeData_canal_a"]
script = ExtResource("6")
node_key = "Canal Alfa"
vertex_meta = SubResource("NetworkNodeMeta_canal_a")

[sub_resource type="Resource" id="NetworkNodeMeta_canal_b"]
script = ExtResource("7")
hidden_message = "Canal Beta absorbe ruido externo."
threat_level = 1
device_type = "Canal"
display_name = "Canal Beta"

[sub_resource type="Resource" id="GraphNodeData_canal_b"]
script = ExtResource("6")
node_key = "Canal Beta"
vertex_meta = SubResource("NetworkNodeMeta_canal_b")

[sub_resource type="Resource" id="NetworkNodeMeta_cuantico"]
script = ExtResource("7")
hidden_message = "Puente Cuántico sincroniza relojes distribuidos."
threat_level = 2
device_type = "Bridge"
display_name = "Puente Cuántico"

[sub_resource type="Resource" id="GraphNodeData_cuantico"]
script = ExtResource("6")
node_key = "Puente Cuántico"
vertex_meta = SubResource("NetworkNodeMeta_cuantico")

[sub_resource type="Resource" id="NetworkNodeMeta_archivo"]
script = ExtResource("7")
hidden_message = "Archivo Delta protege firmas históricas."
threat_level = 2
device_type = "Archive"
display_name = "Archivo Delta"

[sub_resource type="Resource" id="GraphNodeData_archivo"]
script = ExtResource("6")
node_key = "Archivo Delta"
vertex_meta = SubResource("NetworkNodeMeta_archivo")

[sub_resource type="Resource" id="NetworkNodeMeta_sigma"]
script = ExtResource("7")
hidden_message = "Terminal Sigma analiza patrones residuales."
threat_level = 2
device_type = "Terminal"
display_name = "Terminal Sigma"

[sub_resource type="Resource" id="GraphNodeData_sigma"]
script = ExtResource("6")
node_key = "Terminal Sigma"
vertex_meta = SubResource("NetworkNodeMeta_sigma")

[sub_resource type="Resource" id="NetworkNodeMeta_bastion"]
script = ExtResource("7")
hidden_message = "Bastión Sur contiene pulsos hostiles."
threat_level = 2
device_type = "Bastión"
display_name = "Bastión Sur"

[sub_resource type="Resource" id="GraphNodeData_bastion"]
script = ExtResource("6")
node_key = "Bastión Sur"
vertex_meta = SubResource("NetworkNodeMeta_bastion")

[sub_resource type="Resource" id="NetworkNodeMeta_respaldo"]
script = ExtResource("7")
hidden_message = "Cámara de Respaldo lista para sincronía final."
threat_level = 3
device_type = "Backup"
display_name = "Cámara de Respaldo"

[sub_resource type="Resource" id="GraphNodeData_respaldo"]
script = ExtResource("6")
node_key = "Cámara de Respaldo"
vertex_meta = SubResource("NetworkNodeMeta_respaldo")

[node name="Mission_Final" type="Node2D"]
script = ExtResource("1")

[node name="Background" type="Node2D" parent="."]

[node name="TextureRect" type="TextureRect" parent="Background"]
material = SubResource("ShaderMaterial_abame")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -0.5
offset_top = -0.5
offset_right = 1280.0
offset_bottom = 720.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("3_mfvuu")
flip_h = true

[node name="GraphDisplay" type="Node2D" parent="."]
position = Vector2(520, 420)
script = ExtResource("2")
node_scene = ExtResource("3")
edge_scene = ExtResource("4")
layout_type = "force_directed"
edge_label_mode = "weight"
show_edge_direction = true

[node name="GraphBuilder" type="Node" parent="."]
script = ExtResource("5")
nodes = Array[ExtResource("6")]([SubResource("GraphNodeData_core"), SubResource("GraphNodeData_aegis"), SubResource("GraphNodeData_canal_a"), SubResource("GraphNodeData_canal_b"), SubResource("GraphNodeData_cuantico"), SubResource("GraphNodeData_archivo"), SubResource("GraphNodeData_sigma"), SubResource("GraphNodeData_bastion"), SubResource("GraphNodeData_respaldo")])
use_random_connections = true
randomize_edge_weights = true
random_generation_limit = 18

[node name="HUD" type="CanvasLayer" parent="."]

[node name="StatusBar" type="PanelContainer" parent="HUD"]
anchors_preset = 10
anchor_right = 1.0
offset_bottom = 48.0
grow_horizontal = 2
theme = ExtResource("10_mfvuu")

[node name="StatusMargin" type="MarginContainer" parent="HUD/StatusBar"]
layout_mode = 2
theme_override_constants/margin_left = 20
theme_override_constants/margin_top = 8
theme_override_constants/margin_right = 20
theme_override_constants/margin_bottom = 8

[node name="StatusHBox" type="HBoxContainer" parent="HUD/StatusBar/StatusMargin"]
layout_mode = 2
theme_override_constants/separation = 20

[node name="MissionTitle" type="Label" parent="HUD/StatusBar/StatusMargin/StatusHBox"]
layout_mode = 2
theme_override_colors/font_color = Color(1, 0.9, 0.5, 1)
theme_override_font_sizes/font_size = 18
text = "Misión Final: The Core"

[node name="StatusLabel" type="Label" parent="HUD/StatusBar/StatusMargin/StatusHBox"]
unique_name_in_owner = true
layout_mode = 2
size_flags_horizontal = 3
theme_override_colors/font_color = Color(0.7, 0.8, 0.95, 1)
theme_override_font_sizes/font_size = 14
text = "Estado: Red inicializada"
horizontal_alignment = 1

[node name="SidePanel" type="PanelContainer" parent="HUD"]
custom_minimum_size = Vector2(360, 0)
anchors_preset = 11
anchor_left = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -380.0
offset_top = 60.0
offset_right = -20.0
offset_bottom = -20.0
grow_horizontal = 0
grow_vertical = 2
theme = ExtResource("10_mfvuu")

[node name="PanelMargin" type="MarginContainer" parent="HUD/SidePanel"]
layout_mode = 2
theme_override_constants/margin_left = 8
theme_override_constants/margin_top = 8
theme_override_constants/margin_right = 8
theme_override_constants/margin_bottom = 8

[node name="ScrollContainer" type="ScrollContainer" parent="HUD/SidePanel/PanelMargin"]
layout_mode = 2
size_flags_vertical = 3
horizontal_scroll_mode = 0

[node name="VBoxContainer" type="VBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_constants/separation = 20

[node name="ObjectiveSection" type="VBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="ObjectiveHeader" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/ObjectiveSection"]
layout_mode = 2
theme_override_colors/font_color = Color(0.95, 0.85, 0.5, 1)
theme_override_font_sizes/font_size = 15
text = "OBJETIVO"

[node name="DetailLabel" type="RichTextLabel" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/ObjectiveSection"]
unique_name_in_owner = true
custom_minimum_size = Vector2(0, 90)
layout_mode = 2
theme_override_font_sizes/normal_font_size = 12
bbcode_enabled = true
text = "[color=#aabbdd]NEMESIS saboteó el núcleo. Debes completar 4 fases aplicando todos los algoritmos aprendidos para reconstruir el sistema.[/color]"
fit_content = true
scroll_active = false

[node name="Divider1" type="HSeparator" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
layout_mode = 2

[node name="PhaseSection" type="VBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="PhaseHeader" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection"]
layout_mode = 2
theme_override_colors/font_color = Color(0.5, 0.8, 1, 1)
theme_override_font_sizes/font_size = 15
text = "FASES"

[node name="StageTitleLabel" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection"]
unique_name_in_owner = true
layout_mode = 2
theme_override_colors/font_color = Color(0.85, 0.9, 1, 1)
theme_override_font_sizes/font_size = 14
text = "Fase 1: Reconocimiento"

[node name="StageList" type="VBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection"]
layout_mode = 2
theme_override_constants/separation = 6

[node name="StageRow1" type="HBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="StageRow1Label" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow1"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 12
text = "1. Recorrido"

[node name="TraversalStatus" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow1"]
unique_name_in_owner = true
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.7, 0.7, 1)
theme_override_font_sizes/font_size = 12
text = "Pendiente"

[node name="StageRow2" type="HBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="StageRow2Label" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow2"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 12
text = "2. Camino mínimo"

[node name="PathStatus" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow2"]
unique_name_in_owner = true
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.7, 0.7, 1)
theme_override_font_sizes/font_size = 12
text = "Pendiente"

[node name="StageRow3" type="HBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="StageRow3Label" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow3"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 12
text = "3. Reconstrucción (MST)"

[node name="MSTStatus" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow3"]
unique_name_in_owner = true
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.7, 0.7, 1)
theme_override_font_sizes/font_size = 12
text = "Pendiente"

[node name="StageRow4" type="HBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="StageRow4Label" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow4"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 12
text = "4. Flujo máximo"

[node name="FlowStatus" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/PhaseSection/StageList/StageRow4"]
unique_name_in_owner = true
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.7, 0.7, 1)
theme_override_font_sizes/font_size = 12
text = "Pendiente"

[node name="Divider2" type="HSeparator" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
layout_mode = 2

[node name="ControlSection" type="VBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="ControlHeader" type="Label" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/ControlSection"]
layout_mode = 2
theme_override_colors/font_color = Color(0.7, 0.95, 0.7, 1)
theme_override_font_sizes/font_size = 15
text = "CONTROLES"

[node name="ButtonRow" type="VBoxContainer" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/ControlSection"]
layout_mode = 2
theme_override_constants/separation = 8

[node name="SolveStageButton" type="Button" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/ControlSection/ButtonRow"]
unique_name_in_owner = true
custom_minimum_size = Vector2(0, 40)
layout_mode = 2
theme_override_font_sizes/font_size = 13
text = "Resolver Fase Actual"

[node name="RegenerateButton" type="Button" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer/ControlSection/ButtonRow"]
unique_name_in_owner = true
custom_minimum_size = Vector2(0, 36)
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "Regenerar Red"

[node name="Spacer" type="Control" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
layout_mode = 2
size_flags_vertical = 0

[node name="ContinueButton" type="Button" parent="HUD/SidePanel/PanelMargin/ScrollContainer/VBoxContainer"]
unique_name_in_owner = true
visible = false
custom_minimum_size = Vector2(0, 44)
layout_mode = 2
theme_override_font_sizes/font_size = 14
text = "Finalizar Misión"
